<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medieval Kingdom Simulator | Eredhar Studios</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  
  <!-- Game Styles -->
  <link rel="stylesheet" href="medieval-simulator/css/styles.css">
</head>
<body>
  <div class="game-container">
    <!-- Header -->
    <div class="game-header">
      <h1>âš”ï¸ Medieval Kingdom Simulator âš”ï¸</h1>
      <p>Build your settlement, manage resources, and advance your civilization</p>
      <p style="font-size: 0.85rem; color: #888; margin-top: 8px;">v2.0.2 - Hotfix: Population Growth</p>
    </div>

    <!-- Stats Panel -->
    <div class="stats-panel">
      <div class="stat-card">
        <div class="stat-label">ğŸ’° Gold</div>
        <div class="stat-value" id="gold">100</div>
        <div class="stat-rate" id="goldRate">+0/sec</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ğŸŒ¾ Food</div>
        <div class="stat-value" id="food">0</div>
        <div class="stat-rate" id="foodRate">+0/sec</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ğŸ‘¥ Population</div>
        <div class="stat-value" id="population">0</div>
        <div class="stat-rate" id="popRate">+0/sec</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ğŸ“š Research</div>
        <div class="stat-value" id="research">0</div>
        <div class="stat-rate" id="researchRate">+0/sec</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">â±ï¸ Time Survived</div>
        <div class="stat-value" id="time">0s</div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
      <button class="research-btn" onclick="showResearch()">ğŸ”¬ Research Technologies</button>
      <button class="stats-btn" onclick="showStatistics()">ğŸ“Š Kingdom Statistics</button>
      <button class="about-btn" onclick="showAbout()">â„¹ï¸ About</button>
    </div>

    <!-- Kingdom Summary -->
    <div class="kingdom-summary">
      <h2 class="section-title">ğŸ“Š Kingdom Overview</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <h4>ğŸ‘¥ Population: <span id="summaryPopulation">0</span></h4>
          <p>Tax Income: <span id="summaryTaxIncome">+0/sec</span></p>
          <p>Food Consumption: <span id="summaryFoodConsume">-0/sec</span></p>
        </div>
        <div class="summary-item">
          <h4>ğŸŒ¾ Farms: <span id="summaryFarms">0</span></h4>
          <p><span id="summaryFoodProd">Net: +0/sec (0 - 0)</span></p>
        </div>
        <div class="summary-item">
          <h4>ğŸ  Houses: <span id="summaryHouses">0</span></h4>
          <p>Population Capacity: <span id="summaryPopCap">0</span></p>
        </div>
        <div class="summary-item">
          <h4>ğŸª Markets: <span id="summaryMarkets">0</span></h4>
          <p>Market Income: <span id="summaryGoldIncome">+0/sec</span></p>
        </div>
        <div class="summary-item">
          <h4>ğŸ“š Libraries: <span id="summaryLibraries">0</span></h4>
          <p>Research Rate: <span id="summaryResearchRate">+0/sec</span></p>
        </div>
      </div>
    </div>

    <!-- Event Log -->
    <div class="event-log-section">
      <h2 class="section-title">ğŸ“œ Recent Events</h2>
      <div class="event-log" id="eventLog">
        <p class="event-log-empty">No events yet. Your kingdom awaits its fate...</p>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Buildings -->
      <div class="buildings-section">
        <h2 class="section-title">ğŸ° Buildings</h2>
        <div class="building-grid">
          <!-- Farm -->
          <div class="building-card">
            <div class="building-image">
              <img src="medieval-simulator/images/building-farm.png" alt="Farm">
              <span class="building-count-badge" id="farmCount">0</span>
            </div>
            <div class="building-name">ğŸŒ¾ Farm</div>
            <div class="building-actions">
              <button class="building-info-btn" onclick="showBuildingInfo('farm')" title="Building Info">â„¹ï¸</button>
              <button class="building-build-btn" onclick="buyBuilding('farm')" id="farmBuildBtn">+ Build</button>
            </div>
          </div>

          <!-- House -->
          <div class="building-card">
            <div class="building-image">
              <img src="medieval-simulator/images/building-house.png" alt="House">
              <span class="building-count-badge" id="houseCount">0</span>
            </div>
            <div class="building-name">ğŸ  House</div>
            <div class="building-actions">
              <button class="building-info-btn" onclick="showBuildingInfo('house')" title="Building Info">â„¹ï¸</button>
              <button class="building-build-btn" onclick="buyBuilding('house')" id="houseBuildBtn">+ Build</button>
            </div>
          </div>

          <!-- Market -->
          <div class="building-card">
            <div class="building-image">
              <img src="medieval-simulator/images/building-market.png" alt="Market">
              <span class="building-count-badge" id="marketCount">0</span>
            </div>
            <div class="building-name">ğŸª Market</div>
            <div class="building-actions">
              <button class="building-info-btn" onclick="showBuildingInfo('market')" title="Building Info">â„¹ï¸</button>
              <button class="building-build-btn" onclick="buyBuilding('market')" id="marketBuildBtn">+ Build</button>
            </div>
          </div>

          <!-- Library -->
          <div class="building-card">
            <div class="building-image">
              <img src="medieval-simulator/images/building-library.png" alt="Library">
              <span class="building-count-badge" id="libraryCount">0</span>
            </div>
            <div class="building-name">ğŸ“š Library</div>
            <div class="building-actions">
              <button class="building-info-btn" onclick="showBuildingInfo('library')" title="Building Info">â„¹ï¸</button>
              <button class="building-build-btn" onclick="buyBuilding('library')" id="libraryBuildBtn">+ Build</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Trade -->
      <div class="trade-section">
        <h2 class="section-title">ğŸ’± Trade Market</h2>
        <div class="trade-controls">
          <div class="trade-input-group">
            <input 
              type="number" 
              class="trade-input" 
              id="sellAmount" 
              placeholder="Amount of food to sell"
              min="0"
              value="10"
            >
          </div>
          <button class="trade-btn" id="sellBtn" onclick="sellFood()">
            Sell Food (1 Food = 0.5 Gold)
          </button>
          <div class="quick-sell-buttons">
            <button class="quick-sell-btn" onclick="quickSell(10)">10</button>
            <button class="quick-sell-btn" onclick="quickSell(25)">25</button>
            <button class="quick-sell-btn" onclick="quickSell(50)">50</button>
            <button class="quick-sell-btn" onclick="quickSell('all')">All</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Back Link -->
    <div class="back-link">
      <a href="index.html">â† Back to Eredhar Studios</a>
    </div>
  </div>

  <!-- Building Info Modal -->
  <div class="building-info-modal" id="buildingInfoModal">
    <div class="building-info-content">
      <button class="close-modal-btn" onclick="closeBuildingInfo()">âœ•</button>
      <img class="modal-building-image" id="modalBuildingImage" src="" alt="">
      <h2 class="modal-building-title" id="modalBuildingTitle"></h2>
      <p class="modal-building-desc" id="modalBuildingDesc"></p>
      <div class="modal-building-stats" id="modalBuildingStats"></div>
    </div>
  </div>

  <!-- Event Popup -->
  <div class="event-popup" id="eventPopup">
    <div class="event-popup-content">
      <h2 id="eventTitle" class="event-title">Event Title</h2>
      <p id="eventDescription" class="event-description">Event description goes here.</p>
      <div id="eventChoices" class="event-choices"></div>
    </div>
  </div>

  <!-- Game Over Screen -->
  <div class="game-over" id="gameOver">
    <div class="game-over-content">
      <h2>Kingdom Fallen</h2>
      <p>Your kingdom has perished...</p>
      <p id="finalStats"></p>
      <button class="restart-btn" onclick="restartGame()">Build Anew</button>
    </div>
  </div>

  <!-- Research Popup -->
  <div class="research-popup" id="researchPopup">
    <div class="research-content">
      <button class="close-stats-btn" onclick="hideResearch()">âœ•</button>
      <h2 class="stats-title">ğŸ”¬ Technology Research</h2>
      
      <div style="text-align: center; margin-bottom: 30px; padding: 15px; background-color: var(--bg-header); border-radius: 8px; border: 2px solid var(--purple);">
        <p style="color: var(--text-gray); margin-bottom: 10px;">Available Research Points</p>
        <p style="color: var(--purple); font-size: 2rem; font-weight: bold;" id="researchAvailable">0</p>
      </div>

      <!-- Tier 1 -->
      <div class="tech-tier">
        <h3 class="tech-tier-title">Tier 1 Technologies</h3>
        <div class="tech-grid" id="tier1Grid"></div>
      </div>

      <!-- Tier 2 -->
      <div class="tech-tier">
        <h3 class="tech-tier-title">Tier 2 Technologies</h3>
        <div class="tech-grid" id="tier2Grid"></div>
      </div>

      <!-- Tier 3 -->
      <div class="tech-tier">
        <h3 class="tech-tier-title">Tier 3 Technologies</h3>
        <div class="tech-grid" id="tier3Grid"></div>
      </div>
    </div>
  </div>

  <!-- Statistics Screen -->
  <div class="statistics-popup" id="statisticsPopup">
    <div class="statistics-content">
      <button class="close-stats-btn" onclick="hideStatistics()">âœ•</button>
      <h2 class="stats-title">ğŸ“Š Kingdom Statistics</h2>
      
      <!-- Current Kingdom Section -->
      <div class="stats-section">
        <h3 class="stats-section-title">âš”ï¸ Current Kingdom</h3>
        <div class="stats-grid">
          <div class="stat-card-small">
            <div class="stat-icon">â±ï¸</div>
            <div class="stat-info">
              <div class="stat-label-small">Time Survived</div>
              <div class="stat-value-small" id="statCurrentTime">0s</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-info">
              <div class="stat-label-small">Gold Earned</div>
              <div class="stat-value-small" id="statCurrentGold">0</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸŒ¾</div>
            <div class="stat-info">
              <div class="stat-label-small">Food Produced</div>
              <div class="stat-value-small" id="statCurrentFood">0</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸ—ºï¸</div>
            <div class="stat-info">
              <div class="stat-label-small">Buildings Built</div>
              <div class="stat-value-small" id="statCurrentBuildings">0</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-info">
              <div class="stat-label-small">Max Population</div>
              <div class="stat-value-small" id="statCurrentPopulation">0</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸ”¬</div>
            <div class="stat-info">
              <div class="stat-label-small">Technologies</div>
              <div class="stat-value-small" id="statCurrentTech">0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- All-Time Records Section -->
      <div class="stats-section">
        <h3 class="stats-section-title">ğŸ† All-Time Records</h3>
        <div class="stats-grid">
          <div class="stat-card-small">
            <div class="stat-icon">â±ï¸</div>
            <div class="stat-info">
              <div class="stat-label-small">Longest Survival</div>
              <div class="stat-value-small" id="statAllTimeTime">0s</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸ’</div>
            <div class="stat-info">
              <div class="stat-label-small">Total Gold Earned</div>
              <div class="stat-value-small" id="statAllTimeGold">0</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸŒ¾</div>
            <div class="stat-info">
              <div class="stat-label-small">Total Food Produced</div>
              <div class="stat-value-small" id="statAllTimeFood">0</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸ—ºï¸</div>
            <div class="stat-info">
              <div class="stat-label-small">Total Buildings</div>
              <div class="stat-value-small" id="statAllTimeBuildings">0</div>
            </div>
          </div>
          <div class="stat-card-small">
            <div class="stat-icon">ğŸ‘‘</div>
            <div class="stat-info">
              <div class="stat-label-small">Highest Population</div>
              <div class="stat-value-small" id="statAllTimePopulation">0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Achievements Section -->
      <div class="stats-section">
        <h3 class="stats-section-title">ğŸ¯ Achievements</h3>
        <div id="achievementsList" class="achievements-grid">
          <!-- Achievements will be generated by JavaScript -->
        </div>
      </div>

      <!-- Reset Progress Section -->
      <div class="stats-section" style="margin-top: 40px; border-top: 2px solid rgba(255, 224, 130, 0.2); padding-top: 30px;">
        <h3 class="stats-section-title" style="color: #f44336;">âš ï¸ Danger Zone</h3>
        <div style="text-align: center;">
          <p style="color: #ccc; margin-bottom: 15px; font-size: 0.9rem;">
            This will permanently delete ALL your progress, statistics, and achievements.
          </p>
          <button class="reset-all-btn" onclick="confirmResetAll()">ğŸ—‘ï¸ Reset Everything</button>
        </div>
      </div>
    </div>
  </div>

  <!-- About Popup -->
  <div class="about-popup" id="aboutPopup">
    <div class="about-content">
      <button class="close-stats-btn" onclick="hideAbout()">âœ•</button>
      <h2 class="stats-title">â„¹ï¸ About</h2>
      
      <!-- About the Game Section -->
      <div class="about-section">
        <h3 class="stats-section-title">ğŸ° About the Game</h3>
        <p class="about-intro">
          Medieval Kingdom Simulator is an idle kingdom management game where you build and grow your settlement through strategic decisions. Balance resources, expand your population, research technologies, and survive random events to create a thriving medieval kingdom.
        </p>
        <p class="about-intro" style="font-size: 0.95rem; color: #888;">
          Version 2.0.2 - Hotfix: Population Growth
        </p>
      </div>

      <!-- Update History Section -->
      <div class="about-section">
        <h3 class="stats-section-title">ğŸ”„ Update History</h3>
        
        <div class="changelog-entry expanded" onclick="toggleChangelog(this)">
          <div class="changelog-header">
            <div class="changelog-version">
              v2.0.2 - Hotfix: Population Growth
              <span class="changelog-badge">Current</span>
            </div>
            <div class="changelog-arrow">â–¶</div>
          </div>
          <div class="changelog-content">
            <ul class="changelog-list">
              <li>CRITICAL FIX: Population growth now works correctly from 0 population</li>
              <li>Fixed overly aggressive check that prevented initial population growth</li>
              <li>Improved display to show 0/sec instead of negative when population is 0</li>
            </ul>
          </div>
        </div>

        <div class="changelog-entry" onclick="toggleChangelog(this)">
          <div class="changelog-header">
            <div class="changelog-version">
              v2.0.1 - Bug Fixes & Improvements
            </div>
            <div class="changelog-arrow">â–¶</div>
          </div>
          <div class="changelog-content">
            <ul class="changelog-list">
              <li>Fixed disease event triggering even with Public Health immunity</li>
              <li>Fixed refugee event showing incorrect population bonus with Welcoming Culture</li>
              <li>Fixed population growth showing negative rate when at 0</li>
              <li>Fixed achievement progress parsing for numbers with commas</li>
              <li>Improved technology requirement chain validation</li>
              <li>Added rate limiting to prevent button spam</li>
              <li>Better input validation for food trading</li>
              <li>Improved time display for short durations</li>
              <li>Added visual feedback for resource changes</li>
              <li>Code quality improvements and bug fixes</li>
            </ul>
          </div>
        </div>

        <div class="changelog-entry" onclick="toggleChangelog(this)">
          <div class="changelog-header">
            <div class="changelog-version">v2.0.0 - Research System</div>
            <div class="changelog-arrow">â–¶</div>
          </div>
          <div class="changelog-content">
            <ul class="changelog-list">
              <li>Added Research Points resource and Libraries building</li>
              <li>Introduced Technology Tree with 12 unlockable technologies across 3 tiers</li>
              <li>Technologies provide powerful bonuses: boost production, reduce event damage, enhance growth</li>
              <li>New achievements for researching technologies</li>
              <li>Automatic save data migration system for seamless updates</li>
              <li>Version tracking and changelog system</li>
              <li>Enhanced UI with research popup and technology cards</li>
              <li>Refugee events now scale with Welcoming Culture technology</li>
              <li>Disease events reduced by Medicine technologies</li>
            </ul>
          </div>
        </div>

        <div class="changelog-entry" onclick="toggleChangelog(this)">
          <div class="changelog-header">
            <div class="changelog-version">v1.0.0 - Initial Release</div>
            <div class="changelog-arrow">â–¶</div>
          </div>
          <div class="changelog-content">
            <ul class="changelog-list">
              <li>Base game with three building types: Farms, Houses, and Markets</li>
              <li>Resource management system (Gold, Food, Population)</li>
              <li>Random events system with choices and consequences</li>
              <li>Exponential building cost scaling (15% increase per building)</li>
              <li>Event log tracking recent kingdom events</li>
              <li>Statistics tracking and all-time records</li>
              <li>Achievement system with 16+ achievements</li>
              <li>Offline progression - your kingdom grows while you're away</li>
              <li>Save/Load system with auto-save every 10 seconds</li>
              <li>Food trading system for emergency gold</li>
              <li>Population growth based on food security</li>
              <li>Game over conditions and restart functionality</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Credits Section -->
      <div class="about-section">
        <h3 class="stats-section-title">ğŸ‘¨â€ğŸ’» Credits</h3>
        <div class="credits-box">
          <p class="credits-text">Developed with AI by</p>
          <p class="credits-author">Andrei Alexe</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Load JavaScript Modules in Dependency Order -->
  <script src="medieval-simulator/js/config.js"></script>
  <script src="medieval-simulator/js/state.js"></script>
  <script src="medieval-simulator/js/technologies.js"></script>
  <script src="medieval-simulator/js/achievements.js"></script>
  <script src="medieval-simulator/js/events.js"></script>
  <script src="medieval-simulator/js/buildings.js"></script>
  <script src="medieval-simulator/js/trade.js"></script>
  <script src="medieval-simulator/js/save-load.js"></script>
  <script src="medieval-simulator/js/display.js"></script>
  <script src="medieval-simulator/js/building-info.js"></script>
  <script src="medieval-simulator/js/popups.js"></script>
  <script src="medieval-simulator/js/game-loop.js"></script>
  <script src="medieval-simulator/js/main.js"></script>
</body>
</html>
